{"version":3,"file":"figma_rest_api.js","sourceRoot":"","sources":["../../src/connect/figma_rest_api.ts"],"names":[],"mappings":";;;AAKA,8BAMC;AAED,gCAMC;AA2CD,kCAgCC;AA9FD,2CAAuD;AACvD,+CAA0C;AAE1C,MAAM,OAAO,GAAG,OAAO,CAAC,oBAAoB,CAAC,CAAC,OAAO,CAAA;AAErD,SAAgB,SAAS,CAAC,SAAiB,EAAE,cAAuB;IAClE,IAAI,cAAc,EAAE,CAAC;QACnB,gBAAM,CAAC,KAAK,CAAC,yBAAyB,cAAc,EAAE,CAAC,CAAA;QACvD,OAAO,cAAc,CAAA;IACvB,CAAC;IACD,OAAO,0BAA0B,CAAA;AACnC,CAAC;AAED,SAAgB,UAAU,CAAC,WAAmB;IAC5C,OAAO;QACL,eAAe,EAAE,WAAW;QAC5B,cAAc,EAAE,kBAAkB;QAClC,YAAY,EAAE,oBAAoB,OAAO,EAAE;KAC5C,CAAA;AACH,CAAC;AAED,mDAAmD;AACnD,IAAiB,YAAY,CAsC5B;AAtCD,WAAiB,YAAY;IAC3B,IAAY,qBAKX;IALD,WAAY,qBAAqB;QAC/B,4CAAmB,CAAA;QACnB,uDAA8B,CAAA;QAC9B,sCAAa,CAAA;QACb,4CAAmB,CAAA;IACrB,CAAC,EALW,qBAAqB,GAArB,kCAAqB,KAArB,kCAAqB,QAKhC;AAgCH,CAAC,EAtCgB,YAAY,4BAAZ,YAAY,QAsC5B;AAEM,KAAK,UAAU,WAAW,CAAC,GAAW,EAAE,WAAmB;IAChE,IAAI,CAAC;QACH,gBAAM,CAAC,IAAI,CAAC,8CAA8C,CAAC,CAAA;QAC3D,MAAM,QAAQ,GAAG,MAAM,eAAO,CAAC,GAAG,CAAkC,GAAG,EAAE;YACvE,OAAO,EAAE,UAAU,CAAC,WAAW,CAAC;SACjC,CAAC,CAAA;QAEF,IAAI,QAAQ,CAAC,QAAQ,CAAC,MAAM,KAAK,GAAG,EAAE,CAAC;YACrC,gBAAM,CAAC,IAAI,CAAC,uDAAuD,CAAC,CAAA;YACpE,OAAO,QAAQ,CAAC,IAAI,CAAC,QAAQ,CAAA;QAC/B,CAAC;aAAM,CAAC;YACN,gBAAM,CAAC,KAAK,CACV,0DAA0D,QAAQ,CAAC,QAAQ,CAAC,MAAM,EAAE,CACrF,CAAA;YACD,gBAAM,CAAC,KAAK,CAAC,sDAAsD,EAAE,QAAQ,CAAC,IAAI,CAAC,CAAA;YACnF,OAAO,OAAO,CAAC,MAAM,EAAE,CAAA;QACzB,CAAC;IACH,CAAC;IAAC,OAAO,GAAG,EAAE,CAAC;QACb,IAAI,IAAA,oBAAY,EAAC,GAAG,CAAC,EAAE,CAAC;YACtB,IAAI,GAAG,CAAC,QAAQ,EAAE,CAAC;gBACjB,gBAAM,CAAC,KAAK,CACV,uCAAuC,GAAG,CAAC,QAAQ,CAAC,MAAM,MAAM,GAAG,CAAC,QAAQ,CAAC,MAAM,IAAI,GAAG,CAAC,IAAI,EAAE,GAAG,IAAI,GAAG,CAAC,IAAI,EAAE,OAAO,EAAE,CAC5H,CAAA;YACH,CAAC;iBAAM,CAAC;gBACN,gBAAM,CAAC,KAAK,CAAC,uCAAuC,GAAG,CAAC,OAAO,EAAE,CAAC,CAAA;YACpE,CAAC;YACD,gBAAM,CAAC,KAAK,CAAC,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,CAAA;QACxC,CAAC;aAAM,CAAC;YACN,gBAAM,CAAC,KAAK,CAAC,qBAAqB,GAAG,EAAE,CAAC,CAAA;QAC1C,CAAC;QACD,OAAO,OAAO,CAAC,MAAM,EAAE,CAAA;IACzB,CAAC;AACH,CAAC","sourcesContent":["import { isFetchError, request } from '../common/fetch'\nimport { logger } from '../common/logging'\n\nconst version = require('../../package.json').version\n\nexport function getApiUrl(figmaNode: string, apiUrlOverride?: string) {\n  if (apiUrlOverride) {\n    logger.debug(`Using custom API URL: ${apiUrlOverride}`)\n    return apiUrlOverride\n  }\n  return 'https://api.figma.com/v1'\n}\n\nexport function getHeaders(accessToken: string) {\n  return {\n    'X-Figma-Token': accessToken,\n    'Content-Type': 'application/json',\n    'User-Agent': `code-connect-cli/${version}`,\n  }\n}\n\n// These typings are a subset of the Figma REST API\nexport namespace FigmaRestApi {\n  export enum ComponentPropertyType {\n    Boolean = 'BOOLEAN',\n    InstanceSwap = 'INSTANCE_SWAP',\n    Text = 'TEXT',\n    Variant = 'VARIANT',\n  }\n\n  export interface ComponentPropertyDefinition {\n    defaultValue: boolean | string\n    type: ComponentPropertyType\n    /**\n     * All possible values for this property. Only exists on VARIANT properties\n     */\n    variantOptions?: string[]\n    /**\n     * Only exists on INSTANCE_SWAP  properties\n     */\n    preferredValues?: { type: string; key: string }[]\n  }\n\n  export interface Node {\n    // we don't care about other node types\n    type: 'COMPONENT' | 'COMPONENT_SET' | 'OTHER' | 'CANVAS'\n    name: string\n    id: string\n    children: Node[]\n  }\n\n  export interface NodeWithPageInfo extends Node {\n    pageId: string\n    pageName: string\n  }\n\n  export interface Component extends NodeWithPageInfo {\n    type: 'COMPONENT' | 'COMPONENT_SET'\n    componentPropertyDefinitions: Record<string, ComponentPropertyDefinition>\n  }\n}\n\nexport async function getDocument(url: string, accessToken: string): Promise<FigmaRestApi.Node> {\n  try {\n    logger.info('Fetching component information from Figma...')\n    const response = await request.get<{ document: FigmaRestApi.Node }>(url, {\n      headers: getHeaders(accessToken),\n    })\n\n    if (response.response.status === 200) {\n      logger.info('Successfully fetched component information from Figma')\n      return response.data.document\n    } else {\n      logger.error(\n        `Failed to get node information from Figma with status: ${response.response.status}`,\n      )\n      logger.debug('Failed to get node information from Figma with Body:', response.data)\n      return Promise.reject()\n    }\n  } catch (err) {\n    if (isFetchError(err)) {\n      if (err.response) {\n        logger.error(\n          `Failed to get node data from Figma (${err.response.status}): ${err.response.status} ${err.data?.err ?? err.data?.message}`,\n        )\n      } else {\n        logger.error(`Failed to get node data from Figma: ${err.message}`)\n      }\n      logger.debug(JSON.stringify(err.data))\n    } else {\n      logger.error(`Failed to create: ${err}`)\n    }\n    return Promise.reject()\n  }\n}\n"]}