{"version":3,"file":"connect.js","sourceRoot":"","sources":["../../src/commands/connect.ts"],"names":[],"mappings":"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","sourcesContent":["import * as commander from 'commander'\nimport fs from 'fs'\nimport { upload } from '../connect/upload'\nimport { validateDocs } from '../connect/validation'\nimport { createCodeConnectFromUrl } from '../connect/create'\nimport {\n  CodeConnectConfig,\n  CodeConnectExecutableParserConfig,\n  CodeConnectParserlessConfig,\n  CodeConnectReactConfig,\n  ProjectInfo,\n  getProjectInfo,\n  getReactProjectInfo,\n  getRemoteFileUrl,\n  getTsProgram,\n} from '../connect/project'\nimport { LogLevel, error, exitWithError, highlight, logger, success } from '../common/logging'\nimport { CodeConnectJSON } from '../connect/figma_connect'\nimport { convertStorybookFiles } from '../storybook/convert'\nimport { delete_docs } from '../connect/delete_docs'\nimport { runWizard } from '../connect/wizard/run_wizard'\nimport { callParser, handleMessages } from '../connect/parser_executables'\nimport { fromError } from 'zod-validation-error'\nimport { ParseRequestPayload, ParseResponsePayload } from '../connect/parser_executable_types'\nimport z from 'zod'\nimport path from 'path'\nimport { withUpdateCheck } from '../common/updates'\nimport { exitWithFeedbackMessage } from '../connect/helpers'\nimport { parseHtmlDoc } from '../html/parser'\nimport {\n  InternalError,\n  isFigmaConnectFile,\n  parseCodeConnect,\n  ParseFn,\n  ParserError,\n  ResolveImportsFn,\n} from '../connect/parser_common'\nimport { findAndResolveImports, parseReactDoc } from '../react/parser'\nimport { CodeConnectLabel, getInferredLanguageForRaw } from '../connect/label_language_mapping'\nimport { groupCodeConnectObjectsByFigmaUrl, writeTemplateFile } from '../connect/migration_helpers'\nimport { convertRemoteFileUrlToRelativePath } from '../connect/wizard/run_wizard'\nimport { getGitRepoAbsolutePath } from '../connect/project'\n\nexport type BaseCommand = commander.Command & {\n  token: string\n  verbose: boolean\n  outFile: string\n  outDir: string\n  config: string\n  dryRun: boolean\n  dir: string\n  jsonFile: string\n  skipUpdateCheck: boolean\n  exitOnUnreadableFiles: boolean\n  apiUrl?: string\n  removeProps?: boolean\n}\n\nfunction addBaseCommand(command: commander.Command, name: string, description: string) {\n  return command\n    .command(name)\n    .description(description)\n    .usage('[options]')\n    .option('-r --dir <dir>', 'directory to parse')\n    .option('-t --token <token>', 'figma access token')\n    .option('-v --verbose', 'enable verbose logging for debugging')\n    .option('-o --outFile <file>', 'specify a file to output generated Code Connect')\n    .option('-o --outDir <dir>', 'specify a directory to output generated Code Connect')\n    .option('-c --config <path>', 'path to a figma config file')\n    .option('-a --api-url <url>', 'custom Figma API URL to use instead of https://api.figma.com/v1')\n    .option('--skip-update-check', 'skips checking for an updated version of the Figma CLI')\n    .option(\n      '--exit-on-unreadable-files',\n      'exit if any Code Connect files cannot be parsed. We recommend using this option for CI/CD.',\n    )\n    .option('--dry-run', 'tests publishing without actually publishing')\n    .addHelpText(\n      'before',\n      'For feedback or bugs, please raise an issue: https://github.com/figma/code-connect/issues',\n    )\n}\n\nexport function addConnectCommandToProgram(program: commander.Command) {\n  // Main command, invoked with `figma connect`\n  const connectCommand = addBaseCommand(program, 'connect', 'Figma Code Connect').action(\n    withUpdateCheck(runWizard),\n  )\n\n  // Sub-commands, invoked with e.g. `figma connect publish`\n  addBaseCommand(\n    connectCommand,\n    'publish',\n    'Run Code Connect locally to find any files that have figma connections and publish them to Figma. ' +\n      'By default this looks for a config file named \"figma.config.json\", and uses the `include` and `exclude` fields to determine which files to parse. ' +\n      'If no config file is found, this parses the current directory. An optional `--dir` flag can be used to specify a directory to parse.',\n  )\n    .option('--skip-validation', 'skip validation of Code Connect docs')\n    .option('-l --label <label>', 'label to apply to the published files')\n    .option(\n      '-b --batch-size <batch_size>',\n      'optional batch size (in number of documents) to use when uploading. Use this if you hit \"request too large\" errors. See README for more information.',\n    )\n    .action(withUpdateCheck(handlePublish))\n\n  addBaseCommand(\n    connectCommand,\n    'unpublish',\n    'Run to find any files that have figma connections and unpublish them from Figma. ' +\n      'By default this looks for a config file named \"figma.config.json\", and uses the `include` and `exclude` fields to determine which files to parse. ' +\n      'If no config file is found, this parses the current directory. An optional `--dir` flag can be used to specify a directory to parse.',\n  )\n    .option(\n      '--node <link_to_node>',\n      'specify the node to unpublish. This will unpublish for the specified label.',\n    )\n    .option('-l --label <label>', 'label to unpublish for')\n    .action(withUpdateCheck(handleUnpublish))\n\n  addBaseCommand(\n    connectCommand,\n    'parse',\n    'Run Code Connect locally to find any files that have figma connections, then converts them to JSON and outputs to stdout.',\n  )\n    .option('-l --label <label>', 'label to apply to the parsed files')\n    .action(withUpdateCheck(handleParse))\n\n  addBaseCommand(\n    connectCommand,\n    'create',\n    'Generate a Code Connect file with boilerplate in the current directory for a Figma node URL',\n  )\n    .argument('<figma-node-url>', 'Figma node URL to create the Code Connect file from')\n    .action(withUpdateCheck(handleCreate))\n\n  addBaseCommand(\n    connectCommand,\n    'migrate',\n    'Parse Code Connect files and migrate their templates into .figma.js files that can be published directly without parsing.',\n  )\n    .argument('[pattern]', 'glob pattern to match files (optional, uses config if not provided)')\n    .option('-l --label <label>', 'label to apply to the migrated templates')\n    .option(\n      '--output-dir <dir>',\n      'directory to write template files (default: same directory as source file)',\n    )\n    .option('--remove-props', 'remove __props metadata blocks from migrated templates')\n    .action(withUpdateCheck(handleMigrate))\n}\n\nexport function getAccessToken(cmd: BaseCommand) {\n  return cmd.token ?? process.env.FIGMA_ACCESS_TOKEN\n}\n\nfunction getAccessTokenOrExit(cmd: BaseCommand) {\n  const token = getAccessToken(cmd)\n\n  if (!token) {\n    exitWithError(\n      `Couldn't find a Figma access token. Please provide one with \\`--token <access_token>\\` or set the FIGMA_ACCESS_TOKEN environment variable`,\n    )\n  }\n\n  return token\n}\n\nexport function getDir(cmd: BaseCommand) {\n  return cmd.dir ?? process.cwd()\n}\n\nfunction setupHandler(cmd: BaseCommand) {\n  if (cmd.verbose) {\n    logger.setLogLevel(LogLevel.Debug)\n  }\n}\n\ntype ParserDoc = z.infer<typeof ParseResponsePayload>['docs'][0]\n\nfunction transformDocFromParser(\n  doc: ParserDoc,\n  remoteUrl: string,\n  config: CodeConnectConfig,\n): ParserDoc {\n  let source = doc.source\n  if (source) {\n    try {\n      const url = new URL(source)\n      if (url.protocol !== 'http:' && url.protocol !== 'https:') {\n        throw new Error('Invalid URL scheme')\n      }\n    } catch (e) {\n      source = getRemoteFileUrl(source, remoteUrl)\n    }\n  }\n\n  // TODO This logic is duplicated in parser.ts parseDoc due to some type issues\n  let figmaNode = doc.figmaNode\n  if (config.documentUrlSubstitutions) {\n    Object.entries(config.documentUrlSubstitutions).forEach(([from, to]) => {\n      figmaNode = figmaNode.replace(from, to)\n    })\n  }\n\n  return {\n    ...doc,\n    source,\n    figmaNode,\n  }\n}\n\nexport function parseRawFile(\n  filePath: string,\n  label: string | undefined,\n  config?: CodeConnectConfig,\n  dir?: string,\n): CodeConnectJSON {\n  const fileContent = fs.readFileSync(filePath, 'utf-8')\n  const lines = fileContent.split('\\n')\n  const fields: { url?: string; component?: string; source?: string } = {}\n  let templateStartIndex = 0\n\n  // Parse consecutive comment lines at the start of the file\n  for (let i = 0; i < lines.length; i++) {\n    const line = lines[i].trim()\n    // Match pattern: // fieldName=value\n    const match = line.match(/^\\/\\/\\s*(\\w+)=(.+)$/)\n    if (match) {\n      const [, fieldName, fieldValue] = match\n      const normalizedFieldName = fieldName.toLowerCase()\n      if (\n        normalizedFieldName === 'url' ||\n        normalizedFieldName === 'component' ||\n        normalizedFieldName === 'source'\n      ) {\n        fields[normalizedFieldName] = fieldValue.trim()\n      }\n      templateStartIndex = i + 1\n    } else if (line === '' || line.startsWith('//')) {\n      // Allow blank lines or other comments, but don't increment template start\n      continue\n    } else {\n      // First non-comment line found\n      break\n    }\n  }\n\n  if (!fields.url) {\n    throw new Error(\n      `Missing required url field in ${filePath}. Please add a // url=... comment to the top of the file.`,\n    )\n  }\n  let figmaNodeUrl = fields.url\n\n  const template = lines.slice(templateStartIndex).join('\\n')\n\n  // Apply documentUrlSubstitutions if provided\n  if (config?.documentUrlSubstitutions) {\n    Object.entries(config.documentUrlSubstitutions).forEach(([from, to]) => {\n      figmaNodeUrl = figmaNodeUrl.replace(from, to)\n    })\n  }\n\n  // Determine effective label from parameter, config, or default\n  const effectiveLabel = label || config?.label || CodeConnectLabel.Code\n\n  const language = config?.language || getInferredLanguageForRaw(effectiveLabel)\n\n  return {\n    figmaNode: figmaNodeUrl,\n    component: fields.component,\n    template,\n    // nestable by default unless user specifies in template\n    // (templateData.nestable AND template.metadata.nestable need to\n    // be true for instance to be nested)\n    templateData: { nestable: true, isParserless: true },\n    language,\n    label: effectiveLabel,\n    source: fields.source || '',\n    sourceLocation: { line: -1 },\n    metadata: {\n      cliVersion: require('../../package.json').version,\n    },\n  }\n}\n\nexport async function getCodeConnectObjects(\n  cmd: BaseCommand & { label?: string },\n  projectInfo: ProjectInfo,\n  silent = false,\n  skipTemplateHelpers = false,\n): Promise<CodeConnectJSON[]> {\n  if (cmd.jsonFile) {\n    try {\n      const docsFromJson = JSON.parse(fs.readFileSync(cmd.jsonFile, 'utf8'))\n      // Strip internal fields from JSON input\n      return docsFromJson.map((doc: CodeConnectJSON) => {\n        const { _codeConnectFilePath, ...cleanDoc } = doc\n        return cleanDoc as CodeConnectJSON\n      })\n    } catch (e) {\n      logger.error('Failed to parse JSON file:', e)\n    }\n  }\n\n  let codeConnectObjects: CodeConnectJSON[] = []\n\n  if (projectInfo.config.parser === 'react') {\n    codeConnectObjects = await getReactCodeConnectObjects(\n      projectInfo as ProjectInfo<CodeConnectReactConfig>,\n      cmd,\n      silent,\n      skipTemplateHelpers,\n    )\n  } else if (projectInfo.config.parser === 'html') {\n    codeConnectObjects = await getCodeConnectObjectsFromParseFn({\n      parseFn: parseHtmlDoc,\n      fileExtension: 'ts',\n      projectInfo,\n      cmd,\n      silent,\n      skipTemplateHelpers,\n    })\n  } else {\n    const payload: ParseRequestPayload = {\n      mode: 'PARSE',\n      paths: projectInfo.files,\n      config: { ...projectInfo.config, skipTemplateHelpers },\n      verbose: cmd.verbose,\n    }\n\n    try {\n      const stdout = await callParser(\n        // We use `as` because the React parser makes the types difficult\n        // TODO remove once React is an executable parser\n        projectInfo.config as CodeConnectExecutableParserConfig,\n        payload,\n        projectInfo.absPath,\n      )\n\n      const parsed = ParseResponsePayload.parse(stdout)\n\n      const { hasErrors } = handleMessages(parsed.messages)\n\n      if (hasErrors) {\n        exitWithError('Errors encountered calling parser, exiting')\n      }\n\n      codeConnectObjects = parsed.docs.map((doc) => ({\n        ...transformDocFromParser(doc, projectInfo.remoteUrl, projectInfo.config),\n        metadata: {\n          cliVersion: require('../../package.json').version,\n        },\n      }))\n    } catch (e) {\n      if (cmd.verbose) {\n        console.trace(e)\n\n        // Don't say to enable verbose if the user has already enabled it.\n        exitWithError(`Error calling parser: ${e}.`)\n      } else {\n        exitWithError(\n          `Error returned from parser: ${fromError(e)}. Try re-running the command with --verbose for more information.`,\n        )\n      }\n    }\n  }\n\n  const rawTemplateFiles = projectInfo.files.filter(\n    (f: string) => f.endsWith('.figma.js') || f.endsWith('.figma.template.js'),\n  )\n\n  if (rawTemplateFiles.length > 0) {\n    // Resolve the label before parsing so language inference works correctly\n    const resolvedLabel = cmd.label || projectInfo.config.label\n\n    const rawTemplateDocs = rawTemplateFiles.map((file) => {\n      const doc = parseRawFile(file, resolvedLabel, projectInfo.config, projectInfo.absPath)\n      // Store the Code Connect file path for migration purposes\n      doc._codeConnectFilePath = file\n\n      if (!silent || cmd.verbose) {\n        logger.info(success(file))\n      }\n      return doc\n    })\n\n    codeConnectObjects = codeConnectObjects.concat(rawTemplateDocs)\n  }\n\n  if (cmd.label || projectInfo.config.label) {\n    logger.info(`Using label \"${cmd.label || projectInfo.config.label}\"`)\n    codeConnectObjects.forEach((doc) => {\n      doc.label = cmd.label || projectInfo.config.label || doc.label\n    })\n  }\n\n  if (projectInfo.config.language) {\n    logger.info(`Using language \"${projectInfo.config.language}\"`)\n    codeConnectObjects.forEach((doc) => {\n      doc.language = projectInfo.config.language || doc.language\n    })\n  }\n\n  return codeConnectObjects\n}\n\ntype GetCodeConnectObjectsArgs = {\n  parseFn: ParseFn\n  resolveImportsFn?: ResolveImportsFn\n  fileExtension: string | string[]\n  projectInfo: ProjectInfo<CodeConnectConfig>\n  cmd: BaseCommand\n  silent?: boolean\n  skipTemplateHelpers?: boolean\n}\n\n// React/Storybook and HTML parsers are handled as special cases for now, they\n// do not use the parser executable model but instead directly call a function\n// in the code base. We may want to transition them to that model in future.\nasync function getCodeConnectObjectsFromParseFn({\n  /** The function used to parse a source file into a Code Connect object */\n  parseFn,\n  /** Optional function used to resolve imports in a source file */\n  resolveImportsFn,\n  /** The file extension to filter for when checking if files should be parsed */\n  fileExtension,\n  /** Project info */\n  projectInfo,\n  /** The commander command object */\n  cmd,\n  /** Silences console output */\n  silent = false,\n  /** Skip template helpers (used for extract command) */\n  skipTemplateHelpers = false,\n}: GetCodeConnectObjectsArgs) {\n  const codeConnectObjects: CodeConnectJSON[] = []\n\n  const tsProgram = getTsProgram(projectInfo)\n  const { files, remoteUrl, config, absPath } = projectInfo\n\n  for (const file of files.filter((f: string) => isFigmaConnectFile(tsProgram, f, fileExtension))) {\n    try {\n      const docs = await parseCodeConnect({\n        program: tsProgram,\n        file,\n        config,\n        parseFn,\n        resolveImportsFn,\n        absPath,\n        parseOptions: {\n          repoUrl: remoteUrl,\n          debug: cmd.verbose,\n          silent,\n          skipTemplateHelpers,\n        },\n      })\n\n      codeConnectObjects.push(...docs)\n      if (!silent || cmd.verbose) {\n        logger.info(success(file))\n      }\n    } catch (e) {\n      if (!silent || cmd.verbose) {\n        logger.error(`❌ ${file}`)\n        if (e instanceof ParserError) {\n          if (cmd.verbose) {\n            console.trace(e)\n          } else {\n            logger.error(e.toString())\n          }\n          if (cmd.exitOnUnreadableFiles) {\n            logger.info('Exiting due to unreadable files')\n            process.exit(1)\n          }\n        } else {\n          if (cmd.verbose) {\n            console.trace(e)\n          } else {\n            logger.error(new InternalError(String(e)).toString())\n          }\n        }\n      }\n    }\n  }\n\n  return codeConnectObjects\n}\n\nasync function getReactCodeConnectObjects(\n  projectInfo: ProjectInfo<CodeConnectReactConfig>,\n  cmd: BaseCommand,\n  silent = false,\n  skipTemplateHelpers = false,\n) {\n  const codeConnectObjects = await getCodeConnectObjectsFromParseFn({\n    parseFn: parseReactDoc,\n    resolveImportsFn: findAndResolveImports,\n    fileExtension: ['tsx', 'jsx'],\n    projectInfo,\n    cmd,\n    silent,\n    skipTemplateHelpers,\n  })\n\n  const storybookCodeConnectObjects = await convertStorybookFiles({\n    projectInfo: getReactProjectInfo(projectInfo),\n  })\n\n  const allCodeConnectObjects = codeConnectObjects.concat(storybookCodeConnectObjects)\n\n  return allCodeConnectObjects\n}\n\nasync function handlePublish(\n  cmd: BaseCommand & {\n    skipValidation: boolean\n    label: string\n    batchSize: string\n  },\n) {\n  setupHandler(cmd)\n\n  let dir = getDir(cmd)\n  const projectInfo = await getProjectInfo(dir, cmd.config)\n\n  const codeConnectObjects = await getCodeConnectObjects(cmd, projectInfo)\n\n  if (codeConnectObjects.length === 0) {\n    logger.warn(\n      `No Code Connect files found in ${dir} - Make sure you have configured \\`include\\` and \\`exclude\\` in your figma.config.json file correctly, or that you are running in a directory that contains Code Connect files.`,\n    )\n    process.exit(0)\n  }\n\n  if (cmd.dryRun) {\n    logger.info(`Files that would be published:`)\n    logger.info(codeConnectObjects.map((o) => `- ${o.component} (${o.figmaNode})`).join('\\n'))\n  }\n\n  const accessToken = getAccessTokenOrExit(cmd)\n\n  if (cmd.skipValidation) {\n    logger.info('Validation skipped')\n  } else {\n    logger.info('Validating Code Connect files...')\n    var start = new Date().getTime()\n    const valid = await validateDocs(\n      cmd,\n      accessToken,\n      codeConnectObjects,\n      cmd.apiUrl || projectInfo.config.apiUrl,\n    )\n    if (!valid) {\n      exitWithFeedbackMessage(1)\n    } else {\n      var end = new Date().getTime()\n      var time = end - start\n      logger.info(`All Code Connect files are valid (${time}ms)`)\n    }\n  }\n\n  if (cmd.dryRun) {\n    logger.info(`Dry run complete`)\n    process.exit(0)\n  }\n\n  let batchSize\n  if (cmd.batchSize) {\n    batchSize = parseInt(cmd.batchSize, 10)\n    if (isNaN(batchSize)) {\n      logger.error('Error: failed to parse batch-size. batch-size passed must be a number')\n      exitWithFeedbackMessage(1)\n    }\n  }\n\n  upload({\n    accessToken,\n    docs: codeConnectObjects,\n    batchSize: batchSize,\n    verbose: cmd.verbose,\n    apiUrl: cmd.apiUrl || projectInfo.config.apiUrl,\n  })\n}\n\nasync function handleUnpublish(cmd: BaseCommand & { node: string; label: string }) {\n  setupHandler(cmd)\n\n  let dir = getDir(cmd)\n\n  if (cmd.dryRun) {\n    logger.info(`Files that would be unpublished:`)\n  }\n\n  let nodesToDeleteRelevantInfo\n\n  const projectInfo = await getProjectInfo(dir, cmd.config)\n\n  if (cmd.node) {\n    if (!cmd.label) {\n      exitWithError('Label is required when specifying a node')\n    }\n    nodesToDeleteRelevantInfo = [{ figmaNode: cmd.node, label: cmd.label }]\n  } else {\n    const codeConnectObjects = await getCodeConnectObjects(cmd, projectInfo)\n\n    nodesToDeleteRelevantInfo = codeConnectObjects.map((doc) => ({\n      figmaNode: doc.figmaNode,\n      label: cmd.label || projectInfo.config.label || doc.label,\n    }))\n\n    if (cmd.label || projectInfo.config.label) {\n      logger.info(`Using label ${cmd.label || projectInfo.config.label}`)\n    }\n\n    if (cmd.dryRun) {\n      logger.info(`Dry run complete`)\n      process.exit(0)\n    }\n  }\n\n  const accessToken = getAccessTokenOrExit(cmd)\n\n  delete_docs({\n    accessToken,\n    docs: nodesToDeleteRelevantInfo,\n    apiUrl: cmd.apiUrl || projectInfo.config.apiUrl,\n  })\n}\n\nasync function handleParse(cmd: BaseCommand & { label: string }) {\n  setupHandler(cmd)\n\n  const dir = cmd.dir ?? process.cwd()\n  const projectInfo = await getProjectInfo(dir, cmd.config)\n\n  const codeConnectObjects = await getCodeConnectObjects(cmd, projectInfo)\n\n  if (cmd.dryRun) {\n    logger.info(`Dry run complete`)\n    process.exit(0)\n  }\n\n  if (cmd.outFile) {\n    fs.writeFileSync(cmd.outFile, JSON.stringify(codeConnectObjects, null, 2))\n    logger.info(`Wrote Code Connect JSON to ${highlight(cmd.outFile)}`)\n  } else {\n    // don't format the output, so it can be piped to other commands\n    console.log(JSON.stringify(codeConnectObjects, undefined, 2))\n  }\n}\n\nasync function handleCreate(nodeUrl: string, cmd: BaseCommand) {\n  setupHandler(cmd)\n\n  const dir = cmd.dir ?? process.cwd()\n  const projectInfo = await getProjectInfo(dir, cmd.config)\n\n  if (cmd.dryRun) {\n    process.exit(0)\n  }\n\n  const accessToken = getAccessTokenOrExit(cmd)\n\n  return createCodeConnectFromUrl({\n    accessToken,\n    // We remove \\s to allow users to paste URLs inside quotes - the terminal\n    // paste will add backslashes, which the quotes preserve, but expected user\n    // behaviour would be to strip the quotes\n    figmaNodeUrl: nodeUrl.replace(/\\\\/g, ''),\n    outFile: cmd.outFile,\n    outDir: cmd.outDir,\n    projectInfo,\n    cmd,\n  })\n}\n/**\n * Migrate native parser Code Connect files to parserless. For each found doc:\n * - Replace helpers with figma.* versions\n * - Migrate v1 syntax to v2 (equivalent but more readable)\n * - Format as valid parserless file w/ url=\"\" comment\n * - Name collisions are skipped, unless file is from migration (in which case add \"_1\")\n */\nasync function handleMigrate(pattern: string | undefined, cmd: BaseCommand) {\n  setupHandler(cmd)\n\n  const dir = cmd.dir ?? process.cwd()\n  let projectInfo = await getProjectInfo(dir, cmd.config)\n  const documentUrlSubstitutions = projectInfo.config.documentUrlSubstitutions\n\n  // Clear documentUrlSubstitutions so we preserve original URLs in migrated templates\n  projectInfo = {\n    ...projectInfo,\n    config: {\n      ...projectInfo.config,\n      documentUrlSubstitutions: {},\n    },\n  }\n\n  // If a glob pattern is provided, override the project files\n  if (pattern) {\n    const { globSync } = require('glob')\n    const files = globSync(pattern, {\n      cwd: dir,\n      absolute: true,\n      nodir: true,\n    })\n\n    if (files.length === 0) {\n      exitWithError(`No files found matching pattern: ${pattern}`)\n    }\n\n    logger.info(`Found ${files.length} file(s) matching pattern: ${pattern}`)\n    projectInfo = {\n      ...projectInfo,\n      files,\n    }\n  }\n\n  // Parse the files to get Code Connect objects\n  const allCodeConnectObjects = await getCodeConnectObjects(cmd, projectInfo, false, true)\n\n  const codeConnectObjectsByFigmaUrl = groupCodeConnectObjectsByFigmaUrl(allCodeConnectObjects)\n\n  const totalVariants = Object.values(codeConnectObjectsByFigmaUrl).reduce(\n    (acc, obj) => acc + obj.variants.length,\n    0,\n  )\n\n  // TODO support variants (for now filtering on non-variants)\n  const codeConnectObjects = Object.values(codeConnectObjectsByFigmaUrl).flatMap((obj) =>\n    obj.main ? [obj.main] : [],\n  )\n\n  if (codeConnectObjects.length === 0) {\n    exitWithError('No Code Connect objects found to migrate')\n  }\n\n  logger.info(`Found ${codeConnectObjects.length} Code Connect object(s) to migrate`)\n  let migratedCount = 0\n  let skippedCount = 0\n  const errors: string[] = []\n\n  // Track file paths created during this migration run\n  const filePathsCreated = new Set<string>()\n\n  // Get git root path for converting remote URLs to local paths\n  const gitRootPath = getGitRepoAbsolutePath(dir)\n\n  // Migrate each Code Connect object to a template file\n  for (const doc of codeConnectObjects) {\n    try {\n      // Skip if no template (shouldn't happen, but be safe)\n      if (!doc.template) {\n        logger.warn(`Skipping ${doc.figmaNode}: no template found`)\n        skippedCount++\n        continue\n      }\n\n      // Determine local source path for output location\n      let localSourcePath: string | undefined\n\n      if (doc._codeConnectFilePath) {\n        // Use the Code Connect file path directly (preferred)\n        localSourcePath = doc._codeConnectFilePath\n      } else if (doc.source && gitRootPath) {\n        // Fallback: Convert remote file URL to local path\n        const relativePath = convertRemoteFileUrlToRelativePath({\n          remoteFileUrl: doc.source,\n          gitRootPath,\n          dir,\n        })\n        if (relativePath) {\n          // Convert relative path to absolute path for writeTemplateFile\n          localSourcePath = path.resolve(dir, relativePath)\n        }\n      }\n\n      const { outputPath, skipped } = writeTemplateFile(\n        doc,\n        cmd.outDir,\n        dir,\n        localSourcePath,\n        filePathsCreated,\n        cmd.removeProps,\n      )\n\n      if (skipped) {\n        logger.warn(`Skipping ${outputPath}: file already exists`)\n        skippedCount++\n      } else {\n        logger.info(`${success('✓')} Migrated to ${highlight(outputPath)}`)\n        migratedCount++\n      }\n    } catch (error) {\n      const errorMsg = `Failed to migrate ${doc.figmaNode}: ${error}`\n      logger.error(errorMsg)\n      errors.push(errorMsg)\n    }\n  }\n\n  if (migratedCount > 0) {\n    if (cmd.outDir) {\n      const configFilePath = path.join(cmd.outDir, 'figma.config.json')\n      if (fs.existsSync(configFilePath)) {\n        logger.warn(`Config file already exists at ${highlight(configFilePath)}`)\n      } else {\n        const { language: docLanguage, label } = codeConnectObjects[0]\n\n        const language = getInferredLanguageForRaw(label, docLanguage)\n        const config: CodeConnectParserlessConfig = {\n          include: ['**/*.figma.js'],\n          language,\n          label,\n          ...(documentUrlSubstitutions && Object.keys(documentUrlSubstitutions).length > 0\n            ? { documentUrlSubstitutions }\n            : {}),\n        }\n        fs.writeFileSync(configFilePath, JSON.stringify({ codeConnect: config }, null, 2))\n        logger.info(`${success('✓')} Wrote Figma config to ${highlight(configFilePath)}`)\n      }\n    }\n  }\n\n  // Summary\n  console.log('')\n  logger.info(\n    `Migration complete: ${success(`${migratedCount} migrated`)}, ${skippedCount} skipped`,\n  )\n\n  if (totalVariants > 0) {\n    logger.error(\n      `${error(`${totalVariants} variant restriction(s)`)} found, but not supported by the migration script yet`,\n    )\n  }\n\n  if (errors.length > 0) {\n    console.log('')\n    logger.error(`Encountered ${errors.length} error(s):`)\n    errors.forEach((err) => logger.error(`  ${err}`))\n    process.exit(1)\n  }\n\n  if (migratedCount === 0) {\n    exitWithError('No files were migrated')\n  }\n}\n"]}